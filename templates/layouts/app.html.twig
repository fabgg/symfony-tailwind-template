{% extends 'base.html.twig' %}

{% block body %}
<div class="min-h-screen" data-controller="sidebar" data-sidebar-collapsed-value="false">
    {# Overlay mobile #}
    <div data-sidebar-target="overlay" data-action="click->sidebar#closeOverlay"
         class="hidden fixed inset-0 bg-black/50 z-40 lg:hidden"></div>

    {# Sidebar #}
    <aside data-sidebar-target="sidebar"
           class="fixed top-0 left-0 h-full w-64 bg-sidebar z-50 transition-all duration-300 -translate-x-full lg:translate-x-0 flex flex-col">
        {# Logo #}
        <div class="h-16 flex items-center px-4 border-b border-white/10">
            <a href="{{ path('app_home') }}" class="flex items-center gap-3">
                <span class="w-8 h-8 rounded-lg bg-primary-600 text-white flex items-center justify-center font-bold text-sm">Sk</span>
                <span data-sidebar-target="logo" data-sidebar-label class="text-white font-semibold text-lg">Skeleton</span>
            </a>
        </div>

        {# Navigation #}
        <div class="flex-1 overflow-y-auto py-4">
            {% block sidebar_nav %}
                <twig:Sidebar:Nav>
                    <twig:Sidebar:NavItem route="app_home" label="Home" icon='<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0a1 1 0 01-1-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1h-2z"/></svg>' />
                    <twig:Sidebar:NavItem route="app_dashboard" label="Dashboard" icon='<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>' />
                    <twig:Sidebar:NavItem route="app_demo_index" label="Demo" icon='<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>' />
                    <twig:Sidebar:NavGroup label="Styleguide" icon='<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg>'>
                        <twig:Sidebar:NavItem route="app_styleguide_typography" label="Typography" />
                        <twig:Sidebar:NavItem route="app_styleguide_components" label="Components" />
                        <twig:Sidebar:NavItem route="app_styleguide_forms" label="Forms" />
                    </twig:Sidebar:NavGroup>
                </twig:Sidebar:Nav>
            {% endblock %}
        </div>
    </aside>

    {# Main content wrapper #}
    <div data-sidebar-target="content" class="transition-all duration-300 lg:ml-64 min-h-screen flex flex-col">
        {# Topbar #}
        <header class="h-16 bg-surface border-b border-border flex items-center justify-between px-4 sticky top-0 z-30">
            <button type="button" data-action="sidebar#toggle" class="p-2 rounded-lg hover:bg-surface-hover transition-colors text-text-secondary">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
            </button>

            <div class="flex items-center gap-3">
                {# Dark mode toggle #}
                <div data-controller="darkmode">
                    <button type="button" data-action="darkmode#toggle" class="p-2 rounded-lg hover:bg-surface-hover transition-colors text-text-secondary">
                        <span data-darkmode-target="icon">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41m11.32-11.32l1.41-1.41"/><path d="M12 6a6 6 0 0 1 0 12" fill="currentColor" opacity="0.3"/></svg>
                        </span>
                    </button>
                </div>

                {# User dropdown #}
                {% if app.user %}
                    <twig:Topbar:Dropdown userName="{{ app.user.fullName }}" />
                {% endif %}
            </div>
        </header>

        {# Page header #}
        {% if block('page_title') is defined and block('page_title')|trim is not empty %}
        <div class="bg-surface border-b border-border px-6 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-text-primary">{% block page_title %}{% endblock %}</h1>
                <div class="flex items-center gap-2">{% block page_actions %}{% endblock %}</div>
            </div>
        </div>
        {% endif %}

        {# Flash messages #}
        {% for type, messages in app.flashes %}
            {% for message in messages %}
                <div class="px-6 pt-4">
                    <twig:Alert type="{{ type }}" dismissible>{{ message }}</twig:Alert>
                </div>
            {% endfor %}
        {% endfor %}

        {# Main content #}
        <main class="flex-1 p-6">
            {% block content %}{% endblock %}
        </main>

        {# Footer #}
        <footer class="border-t border-border px-6 py-4 text-sm text-text-muted">
            {% block footer %}
            <div class="flex items-center justify-between">
                <span>&copy; {{ "now"|date("Y") }} Skeleton</span>
                <a href="{{ path('app_legal_mentions') }}" class="hover:text-text-secondary transition-colors">Legal Notice</a>
            </div>
            {% endblock %}
        </footer>
    </div>
</div>
{% endblock %}
